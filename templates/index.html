<!doctype html> <!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
  <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>{% block title %}{% endblock %}</title>
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="{{ STATIC_URL }}/img/favicon.png" type="image/x-icon" />

    <meta name="viewport" content="width=device-width,initial-scale=1">
  </head>
  <body >

    <div id="main">

    </div>

    <script id="layout-main" type="layout">
      <div class='content'>

      </div>
    </script>

    <script id="tpl-media" type="template">
      <img src="<%= thumbnails.small.url %>">
    </script>

    <script id="tpl-media-list" type="template">
      <ul class='thumbnails'></ul>
    </script>

    <script src="{{ STATIC_URL }}/backbones/vendor/js/libs/jquery-1.8.2.js"></script>
    <script src="{{ STATIC_URL }}/backbones/vendor/bootstrap/js/bootstrap.js"></script>
    <script src="{{ STATIC_URL }}/backbones/vendor/js/libs/underscore.js"></script>
    <script src="{{ STATIC_URL }}/backbones/vendor/js/libs/backbone.js"></script>
    <script src="{{ STATIC_URL }}/backbones/vendor/js/libs/backbone.layoutmanager.js"></script>

    <script>
      $(function() {

        Backbone.LayoutManager.configure({
          manage : true
        });

        // model
        Media = Backbone.Model.extend({

          urlRoot : '/rest/medias',

          // Ensure that each todo created has `title`.
          initialize : function() {
          },
          // Remove this Todo from *localStorage* and delete its view.
          clear : function() {
            this.destroy();
          }
        });

        // collection
        MediaList = Backbone.Collection.extend({
          url : '/rest/medias',
          // Reference to this collection's model.
          model : Media
        });

        var medias = new MediaList();

        // Media view
        var MediaView = Backbone.View.extend({

          //... is a list tag.
          tagName : "li",

          // Cache the template function for a single item.
          template : '#tpl-media',

          // The TodoView listens for changes to its model, re-rendering. Since there's
          // a one-to-one correspondence between a **Todo** and a **TodoView** in this
          // app, we set a direct reference on the model for convenience.
          initialize : function() {
            this.model.bind('change', this.render, this);
            this.model.bind('destroy', this.remove, this);
          },

          serialize : function() {
            return this.model.toJSON();
          },

          // Re-render the titles of the todo item.
          /*render : function() {
            this.$el.html(this.template(this.model.toJSON()));

            return this;
          },*/

          // Remove the item, destroy the model.
          clear : function() {
            this.model.clear();
          }
        });

        // Applicaiton view
        var MediaListView = Backbone.View.extend({

          template : '#tpl-media-list',

          // At initialization we bind to the relevant events on the `Todos`
          // collection, when items are added or changed. Kick things off by
          // loading any preexisting todos that might be saved in *localStorage*.
          initialize : function() {

            medias.bind('add', this.addOne, this);
            medias.bind('reset', this.addAll, this);
            //medias.bind('all', this.render, this);

            //this.footer = this.$('footer');
            //this.main = $('#main');
            
            //
          },

          // Add a single todo item to the list by creating a view for it, and
          // appending its element to the `<ul>`.
          addOne : function(todo) {
            var view = new MediaView({
              model : todo
            });
            
            this.$('.thumbnails').append(view.render().el);
          },

          // Add all items in the **Todos** collection at once.
          addAll : function() {
            medias.each(this.addOne);
          }
        });

        var main = new Backbone.Layout({
          template : "#layout-main",

          views : {
            ".content" : new MediaListView()
          }
        });

        // Attach the Layout to the <body></body>.
        $("#main").empty().append(main.el);

        // Render the Layout.
        main.render();
        medias.fetch({data:{is_an_album:1}});
        
      });
    </script>

  </body>
</html>